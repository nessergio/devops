{
  "title": "Overall status",
  "uid": "prod-demo",
  "timezone": "browser",
  "panels": [
    {
      "title": "Response time (90% quantile)",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "demo_http_response_time_seconds{quantile='0.9',method='GET',status='200'}",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12 }
    },
    {
      "title": "Requests per second",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(demo_http_response_count_total[1m])) by (ipv4)",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12, "x": 12 }
    },
    {
      "title": "Status codes per second != 200",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(demo_http_response_count_total{status!='200'}[1m])) by (status)",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12 }
    },
    {
      "title": "HTTP traffic",
      "type": "timeseries",
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "unit": "bytes"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(demo_http_response_size_bytes[1m])) by (ipv4)",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12, "x": 12 }
    },
    {
      "title": "Running workers",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(up{job='worker'})",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12 }
    },
    {
      "title": "Running containers",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(engine_daemon_container_states_containers{state='running'}) by (ipv4)-5",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12, "x": 12 }
    },
    {
      "title": "CPU Usage",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "100 - (avg(irate(node_cpu_seconds_total{mode='idle'}[1m])) by (ipv4) * 100)",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12 }
    },
    {
      "title": "Load per container",
      "type": "timeseries",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "(sum(rate(demo_http_response_count_total[1m])) by (ipv4))/(sum(engine_daemon_container_states_containers{state='running'}-5) by (ipv4))",
          "legendFormat": "{{ ipv4 }}"
        }
      ],
      "timeFrom": "1h",
      "gridPos": { "h": 8, "w": 12, "x": 12 }
    }
  ],
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ],
    "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
  }
}
